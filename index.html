<!DOCTYPE html>
<html>
<head>
  <title>Neuron Chatbot</title>
  <style>
    body { font-family: monospace; background:#111; color:#0f0; padding:20px; }
    input { width:70%; background:black; color:#0f0; border:1px solid #0f0; }
    button { background:black; color:#0f0; border:1px solid #0f0; margin-left:5px; }
  </style>
</head>
<body>
<h2>Neuron Chatbot (Real NN)</h2>
<div id="chat"></div>
<input id="input" placeholder="type here">
<button onclick="send()">Send</button>
<button onclick="trainAI()">Train AI</button>
<div id="status"></div>

<script>
// Conversational dataset (plain text)
const data = [
  ["hello","Hello!"],
  ["hi","Hi there!"],
  ["how are you","I'm doing well, thanks!"],
  ["what's up","Not much, you?"],
  ["yo","Hey!"],
  ["bye","Goodbye!"],
  ["see you","See you later!"],
  ["thanks","You're welcome!"],
  ["thank you","Anytime!"],
  ["how old are you","I am a neural network, I don't age."],
  ["who are you","I'm a chatbot powered by neurons!"],
  ["help","Sure! What do you need?"],
  ["yes","Yes!"],
  ["no","No!"]
];

// Build character vocab
let chars = new Set();
data.forEach(d => d[0].split("").forEach(c=>chars.add(c)));
chars = Array.from(chars);
const map = Object.fromEntries(chars.map((c,i)=>[c,i]));

function encode(text){
  let x = new Array(chars.length).fill(0);
  for(let c of text.toLowerCase()){
    if(map[c]!==undefined) x[map[c]]++;
  }
  return x;
}

// Neural net sizes
let inputSize = chars.length;
let hiddenSize = 128; // More neurons
let outputSize = data.length;

// Weights
let w1 = Array.from({length:inputSize},()=>Array.from({length:hiddenSize},()=>Math.random()*0.01));
let b1 = new Array(hiddenSize).fill(0);
let w2 = Array.from({length:hiddenSize},()=>Array.from({length:outputSize},()=>Math.random()*0.01));
let b2 = new Array(outputSize).fill(0);

function relu(x){ return x.map(v=>Math.max(0,v)); }
function softmax(x){
  let m = Math.max(...x);
  let ex = x.map(v=>Math.exp(v-m));
  let s = ex.reduce((a,b)=>a+b,0);
  return ex.map(v=>v/s);
}

function forward(x){
  let h = b1.map((v,j)=>v + x.reduce((s,xi,i)=>s+xi*w1[i][j],0));
  h = relu(h);
  let o = b2.map((v,j)=>v + h.reduce((s,hi,i)=>s+hi*w2[i][j],0));
  return {h, out: softmax(o)};
}

// Auto-train function
function trainAI(){
  let status = document.getElementById("status");
  status.innerText = "Training AI...";
  setTimeout(()=>{
    let epochs = 5000; // More epochs for better learning
    let lr = 0.01;
    for(let epoch=0; epoch<epochs; epoch++){
      for(let i=0;i<data.length;i++){
        let x = encode(data[i][0]);
        let y = new Array(outputSize).fill(0); y[i]=1;
        let {h,out} = forward(x);

        // output error
        let err = out.map((v,j)=>v-y[j]);

        // update w2
        for(let j=0;j<hiddenSize;j++)
          for(let k=0;k<outputSize;k++)
            w2[j][k] -= lr * err[k] * h[j];
        for(let k=0;k<outputSize;k++) b2[k] -= lr * err[k];

        // hidden error
        let hiddenErr = new Array(hiddenSize).fill(0);
        for(let j=0;j<hiddenSize;j++)
          for(let k=0;k<outputSize;k++)
            hiddenErr[j] += err[k]*w2[j][k];

        // update w1
        for(let j=0;j<inputSize;j++)
          for(let k=0;k<hiddenSize;k++)
            w1[j][k] -= lr * hiddenErr[k] * x[j];
        for(let k=0;k<hiddenSize;k++) b1[k] -= lr * hiddenErr[k];
      }
    }
    status.innerText = "Training complete!";
  }, 10);
}

function send(){
  let msg = document.getElementById("input").value;
  if(msg==="") return;
  let x = encode(msg);
  let {out} = forward(x);
  let i = out.indexOf(Math.max(...out));

  document.getElementById("chat").innerHTML += "<div>You: "+msg+"</div>";
  document.getElementById("chat").innerHTML += "<div>AI: "+data[i][1]+"</div>";
  document.getElementById("input").value="";
}
</script>
</body>
</html>
